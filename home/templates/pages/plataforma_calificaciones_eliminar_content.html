{% load static %}
{% load custom_filters %}

<!-- Contenido de Eliminación de Evaluación -->
<div class="eliminar-evaluacion-content">
  <!-- Advertencia -->
  <div class="warning-card text-center mb-4">
    <div class="warning-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <h3 class="mb-3">
      {% if tiene_calificaciones %}
        ¡Advertencia!
      {% else %}
        Confirmar Eliminación
      {% endif %}
    </h3>
    <p class="mb-0">Estás a punto de eliminar la evaluación <strong>"{{ evaluacion.nombre }}"</strong>.</p>
    {% if tiene_calificaciones %}
      <p class="mb-0">Esta acción eliminará también todas las calificaciones asociadas y no se puede deshacer.</p>
    {% else %}
      <p class="mb-0">Esta evaluación no tiene calificaciones asignadas, por lo que se eliminará directamente.</p>
    {% endif %}
  </div>
</div>
  
  <!-- Información de la Evaluación -->
<div class="evaluacion-info mb-4">
  <h4 class="mb-3">
    <i class="fas fa-clipboard-list me-2"></i>Información de la Evaluación
  </h4>
  <div class="row">
    <div class="col-md-6">
      <p><strong>Nombre:</strong> {{ evaluacion.nombre }}</p>
      <p><strong>Tipo:</strong> {{ evaluacion.get_tipo_display }}</p>
      <p><strong>Período:</strong> {{ evaluacion.fecha_inicio|date:"d/m/Y" }} - {{ evaluacion.fecha_fin|date:"d/m/Y" }}</p>
      <p><strong>Nota Máxima:</strong> {{ evaluacion.nota_maxima }}</p>
      <p><strong>Ponderación:</strong> {{ evaluacion.ponderacion }}%</p>
    </div>
    <div class="col-md-6">
      {% if evaluacion.descripcion %}
        <p><strong>Descripción:</strong></p>
        <p class="text-muted">{{ evaluacion.descripcion }}</p>
      {% endif %}
    </div>
  </div>
  
  <div class="stats-grid">
    <div class="stat-item">
      <span class="stat-value">{{ evaluacion.get_calificaciones_count }}</span>
      <span class="stat-label">Calificaciones Registradas</span>
    </div>
    <div class="stat-item">
      <span class="stat-value">
        {% if evaluacion.get_promedio %}
          {{ evaluacion.get_promedio|floatformat:1 }}
        {% else %}
          N/A
        {% endif %}
      </span>
      <span class="stat-label">Promedio General</span>
    </div>
    <div class="stat-item">
      <span class="stat-value">{{ evaluacion.fecha_creacion|date:"d/m/Y" }}</span>
      <span class="stat-label">Fecha de Creación</span>
    </div>
    <div class="stat-item">
      <span class="stat-value">
        {% if evaluacion.activa %}
          <span class="badge bg-success">Activa</span>
        {% else %}
          <span class="badge bg-secondary">Inactiva</span>
        {% endif %}
      </span>
      <span class="stat-label">Estado</span>
    </div>
  </div>
</div>
  
  <!-- Formulario de Confirmación -->
<div class="eliminar-evaluacion-form">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="section-content">
        <h4 class="mb-4 text-center">
          <i class="fas fa-question-circle me-2"></i>Confirmar Eliminación
        </h4>
        
        <form id="formEliminarEvaluacion" method="post" data-evaluacion-id="{{ evaluacion.id }}">
          {% csrf_token %}
          
          {% if tiene_calificaciones %}
            <div class="text-center mb-4">
              <p class="text-muted">
                Para confirmar la eliminación, escribe <strong>"ELIMINAR"</strong> en el campo de abajo:
              </p>
            </div>
            
            <div class="form-group">
              <label for="confirmacion" class="form-label">
                <i class="fas fa-keyboard me-1"></i>Confirmación
              </label>
                            <input type="text" id="confirmacion" name="confirmacion" class="form-control" 
                     placeholder="Escribe 'ELIMINAR' para confirmar" required autocomplete="off">
              <small class="form-text text-muted">
                Esta acción no se puede deshacer. Todas las calificaciones asociadas serán eliminadas permanentemente.
              </small>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mt-4">
              <button type="button" class="btn btn-secondary" onclick="cargarCalificaciones()">
                <i class="fas fa-times me-2"></i>Cancelar
              </button>
              <button type="submit" class="btn btn-danger" id="btnEliminar" disabled>
                <i class="fas fa-trash-alt me-2"></i>Eliminar Evaluación
              </button>
            </div>
          {% else %}
            <div class="text-center mb-4">
              <p class="text-muted">
                Esta evaluación no tiene calificaciones asignadas y se eliminará directamente.
              </p>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mt-4">
              <button type="button" class="btn btn-secondary" onclick="cargarCalificaciones()">
                <i class="fas fa-times me-2"></i>Cancelar
              </button>
              <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash-alt me-2"></i>Eliminar Evaluación
              </button>
            </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
  </div>
<style>
  .warning-card {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
    border-radius: 10px;
    padding: 30px;
    margin-bottom: 30px;
  }
  
  .warning-icon {
    font-size: 3rem;
    margin-bottom: 20px;
  }
  
  .evaluacion-info {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  .stat-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    display: block;
  }
  
  .stat-label {
    font-size: 0.9rem;
    color: #666;
    margin-top: 5px;
  }
  
  .section-content {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  
  /* Estilos para el formulario de eliminación */
  .eliminar-evaluacion-form {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100%;
    margin-top: 20px;
    z-index: 1000 !important;
  }

  .eliminar-evaluacion-form * {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Asegurar que los botones estén en la posición correcta */
  .eliminar-evaluacion-form .d-flex.justify-content-between {
    justify-content: space-between !important;
    flex-direction: row !important;
    width: 100%;
  }
  
  .eliminar-evaluacion-form .btn-secondary {
    order: 1;
  }
  
  .eliminar-evaluacion-form .btn-danger {
    order: 2;
  }
  
  /* Estilos para el campo de confirmación */
  .eliminar-evaluacion-form #confirmacion {
    border: 2px solid #dee2e6 !important;
    border-radius: 0.375rem !important;
    padding: 0.75rem 1rem !important;
    font-size: 1rem !important;
    line-height: 1.5 !important;
    color: #495057 !important;
    background-color: #fff !important;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out !important;
  }
  
  .eliminar-evaluacion-form #confirmacion:focus {
    border-color: #667eea !important;
    outline: 0 !important;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
  }
  
  .eliminar-evaluacion-form #confirmacion::placeholder {
    color: #6c757d !important;
    opacity: 1 !important;
  }
  
  /* Hacer que el formulario tenga el mismo ancho que la información de evaluación */
  .eliminar-evaluacion-form .row {
    width: 100%;
    margin: 0;
  }
  
  .eliminar-evaluacion-form .col-lg-8 {
    width: 100%;
    max-width: none;
    flex: 0 0 100%;
  }
  
  .eliminar-evaluacion-form .section-content {
    width: 100%;
    margin: 0;
  }
</style>

 