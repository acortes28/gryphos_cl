{% load i18n static theme_material_kit %}

<!-- Navbar -->
<div class="container position-sticky z-index-sticky top-0">
  <div class="row">
    <div class="col-12">
      <nav class="navbar navbar-expand blur border-radius-xl top-0 mt-4 z-index-fixed shadow position-absolute my-3 py-2 start-0 end-0 mx-4">
        <div class="container-fluid px-0">
          <a class="navbar-brand font-weight-bolder ms-sm-3" href="/" rel="tooltip" title="Compromiso y crecimiento mutuo" data-placement="bottom">
            Gryphos Consulting
          </a>
          <ul class="navbar-nav navbar-nav-hover ms-auto">
            <li class="nav-item dropdown dropdown-hover mx-3">
              <a class="nav-link ps-2 d-flex cursor-pointer align-items-center" id="dropdownMenuPages"
                data-bs-toggle="dropdown" aria-expanded="false">
                  [☰] Menú
              </a>
              <div class="dropdown-menu dropdown-menu-animation ms-0 ms-n3 p-none border-radius-xl h-auto w-auto" aria-labelledby="dropdownMenuPages">
                <h6 class="dropdown-header text-dark font-weight-bolder d-flex align-items-center">
                  Portal
                </h6>
                {% if request.user.is_superuser %}
                  {% admin_get_menu as app_list %}
                  {% if app_list %}
                    {% for app in app_list %}
                      {% if app.has_perms and not app.pinned %}
                        <a href="{{ app.url }}" class="dropdown-item border-radius-md">
                          <span>{{ app.label|slice:10 }}{% if app.label|length > 10 %}..{% endif %}</span>
                        </a>
                        {% if app.models %}
                          {% for model in app.models %}
                            {% if model.url %}
                              <a class="dropdown-item ms-0" href="{{ model.url }}">
                                {{ model.label }}
                              </a>
                            {% else %}
                              <span class="dropdown-item ms-0 disabled">{{ model.label }}</span>
                            {% endif %}
                          {% endfor %}
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                {% endif %}
                <!-- Additional items for different user states and general navigation -->
                <a href="{% url 'que-hacemos' %}" class="dropdown-item border-radius-md">
                  <span>Qué hacemos</span>
                </a>
                <a href="{% url 'quienes-somos' %}" class="dropdown-item border-radius-md">
                  <span>Quiénes somos</span>
                </a>
                <a href="{% url 'inscripcion-curso' %}" class="dropdown-item border-radius-md">
                  <span>Inscripción de curso de capacitación</span>
                </a>
                {% if settings.DEBUG %}
                <a href="{% url 'test_auth' %}" class="dropdown-item border-radius-md">
                  <span>Test de Autenticación</span>
                </a>
                <a href="{% url 'test_registration' %}" class="dropdown-item border-radius-md">
                  <span>Test de Registro</span>
                </a>
                {% endif %}
                {% if request.user.is_authenticated %}
                  <h6 class="dropdown-header text-dark font-weight-bolder d-flex align-items-center">
                    Usuario
                  </h6>
                  {% if request.user.is_staff %}
                    <a href="{% url 'admin:index' %}" class="dropdown-item border-radius-md">
                      <span>Portal de Administradores</span>
                    </a>
                    <a href="{% url 'admin-inscripciones' %}" class="dropdown-item border-radius-md">
                      <span>Gestión de Inscripciones</span>
                    </a>
                    <a href="{% url 'user_space' %}" class="dropdown-item border-radius-md">
                      <span>Portal de Miembros</span>
                    </a>
                    <a href="#" class="dropdown-item border-radius-md" id="generateRegistrationLink">
                      <span>Generar enlace de registro</span>
                    </a>
                    <a href="{% url 'admin:password_change' %}" class="dropdown-item border-radius-md">
                      <span>Cambiar contraseña</span>
                    </a>
                    <a href="{% url 'admin:logout' %}" class="dropdown-item border-radius-md">
                      <span>Cerrar sesión</span>
                    </a>
                  {% else %}
                    <a href="{% url 'user_space' %}" class="dropdown-item border-radius-md">
                      <span>Portal de Miembros</span>
                    </a>
                    <a href="{% url 'password_change' %}" class="dropdown-item border-radius-md">
                      <span>Cambiar contraseña</span>
                    </a>
                    <a href="{% url 'logout' %}" class="dropdown-item border-radius-md">
                      <span>Cerrar sesión</span>
                    </a>
                  {% endif %}
                {% else %}
                  <a href="{% url 'login' %}" class="dropdown-item border-radius-md">
                    <span>Iniciar sesión</span>
                  </a>
                {% endif %}
              </div>
            </li>
            <!-- Login/Logout Button -->
            {% if request.user.is_authenticated %}
            <li class="nav-item ms-2">
              <a class="nav-link" href="{% url 'logout' %}">
                <i class="fa fa-sign-out me-1"></i>
                Logout
              </a>
            </li>
            {% else %}
            <li class="nav-item ms-2">
              <a class="nav-link" href="{% url 'login' %}">
                <i class="fa fa-sign-in me-1"></i>
                Login
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </nav>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var generateLinkButton = document.getElementById('generateRegistrationLink');
    if (generateLinkButton) {
        generateLinkButton.addEventListener('click', function(e) {
            e.preventDefault();
            fetch('{% url "generate-registration-link" %}')
                .then(response => response.json())
                .then(data => {
                    if (data.link) {
                        navigator.clipboard.writeText(window.location.origin + '/accounts/register/' + data.link)
                            .then(() => alert('Enlace de registro copiado al portapapeles: ' + window.location.origin + '/accounts/register/' + data.link));
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    }
});
</script>